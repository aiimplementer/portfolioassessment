<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Portfolio — Wealth Assessment</title>

  <style>
 
    :root {
      --bg-dark-1: #050B18;
      --bg-dark-2: #08142E;
      --bg-card: rgba(255, 255, 255, 0.06);
      --border-glass: rgba(255, 255, 255, 0.14);

      --text-main: #E6EDFF;
      --text-muted: #9AA4C7;

      --accent: #38E8FF;
      --accent-soft: rgba(56, 232, 255, 0.18);

      --success: #15803D;
      --error: #B91C1C;

      --radius-lg: 18px;
      --radius-md: 12px;

      --shadow-soft: 0 20px 50px rgba(0, 0, 0, 0.45);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, sans-serif;
      background:
        radial-gradient(1200px 500px at 50% -200px, #0B2B5E 0%, transparent 60%),
        linear-gradient(180deg, var(--bg-dark-2), var(--bg-dark-1));
      color: var(--text-main);
      min-height: 100vh;
    }

    .page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 20px 96px;
    }

    header {
      text-align: center;
      margin-bottom: 56px;
    }

    header h1 {
      margin: 0;
      font-size: 42px;
      font-weight: 800;
      background: linear-gradient(90deg, #7CF9FF, #38E8FF);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    header p {
      margin-top: 14px;
      font-size: 17px;
      color: var(--text-muted);
      max-width: 720px;
      margin-left: auto;
      margin-right: auto;
    }

    .upload-card {
      padding: 22px;
      background: var(--bg-card);
      backdrop-filter: blur(14px);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-glass);
      box-shadow: var(--shadow-soft);
    }

    .upload-card h2 {
      margin: 0 0 20px;
      font-size: 22px;
      font-weight: 700;
      color: var(--accent);
    }

    input[type="file"] {
      width: 100%;
      padding: 12px;
      border-radius: var(--radius-md);
      border: 1px dashed var(--border-glass);
      background: rgba(255, 255, 255, 0.05);
      color: var(--text-main);
    }

    input[type="file"]::file-selector-button {
      margin-right: 12px;
      padding: 8px 14px;
      border-radius: 10px;
      border: none;
      background: var(--accent-soft);
      color: var(--accent);
      font-weight: 600;
      cursor: pointer;
    }

    .btn-submit {
      margin-top: 22px;
      width: 100%;
      padding: 14px;
      background: linear-gradient(90deg, #38E8FF, #2BC0FF);
      color: #001018;
      border: none;
      border-radius: var(--radius-md);
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: opacity 0.25s ease, transform 0.15s ease;
    }

    .btn-submit:active {
      transform: scale(0.98);
    }

    /* ✅ CLEAR DISABLED STATE */
    .btn-submit:disabled {
      opacity: 0.55;
      cursor: not-allowed;
      transform: none;
    }

    #message {
      margin-top: 14px;
      text-align: center;
      font-size: 14px;
      color: var(--text-muted);
    }

    /* REPORT AREA */
    #result {
      display: none;
      margin: 56px auto 0;
      padding: 32px;
      background: #FFFFFF;
      color: #0F172A;
      border-radius: var(--radius-lg);
      border: 1px solid #CBD5E1;
      box-shadow: 0 10px 30px rgba(0,0,0,.15);
    }

    #result table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    #result thead th {
      background: #0F172A;
      color: #F8FAFC;
      padding: 10px 12px;
      text-align: left;
    }

    #result tbody tr:nth-child(even) {
      background: #EEF2F7;
    }

    #result td {
      padding: 9px 12px;
      border-bottom: 1px solid #CBD5E1;
    }

    .gain { color: #15803D; font-weight: 600; }
    .loss { color: #B91C1C; font-weight: 600; }

    @media print {
      header, .upload-card, #message {
        display: none !important;
      }

      body {
        background: #fff !important;
      }

      #result {
        display: block !important;
        box-shadow: none;
        border: none;
        padding: 0;
      }
    }
	
	/* Header bar with centered title */
	.header-bar {
	  position: relative;
	  display: flex;
	  align-items: center;
	  min-height: 60px;
	  margin-bottom: 56px;
	}

	/* Logo on left */
	.header-logo {
	  height: 36px;
	  object-fit: contain;
	}

	/* Truly centered title */
	.header-title {
	  position: absolute;
	  left: 50%;
	  transform: translateX(-50%);
	  margin: 0;
	  font-size: 42px;
	  font-weight: 800;
	  background: linear-gradient(90deg, #7CF9FF, #38E8FF);
	  -webkit-background-clip: text;
	  -webkit-text-fill-color: transparent;
	  white-space: nowrap;
	}

    /* Status Starts*/
	/* ===== STATUS ===== */
	.status{
	  margin-top:16px;
	  text-align:center;
	  font-size:14px;
	  min-height:22px;
	}
	.success{color:#22c55e}
	.error{color:#ef4444}

	/* ===== FOOTER ===== */
	.footer-bar{
	  display:flex;
	  align-items:center;
	  justify-content:space-between; /* LEFT ↔ RIGHT */
	  gap:20px;
	  padding:14px 20px;
	  border-top:1px solid var(--border);
	  font-size:13px;
	  color:var(--text-muted);
	}


	.footer-status{
	  display:flex;
	  align-items:center;
	  gap:22px;
	}

	.status-item{
	  display:flex;
	  align-items:center;
	  gap:6px;
	  white-space:nowrap;
	}

	.dot{
	  width:8px;
	  height:8px;
	  border-radius:50%;
	  background:#6b7280;
	}
	.dot.up{background:#22c55e}
	.dot.down{background:#ef4444}

	footer a{
	  color:var(--accent);
	  text-decoration:none;
	}
	/* Status Ends*/
	
	.logo{
       height:44px;
    } 
	
	.header-bar{
		display:flex;
		align-items:center;
		padding:14px 20px;
	}

	
	.user-area{
		margin-left:auto;        /* move to right */
		display:flex;
		flex-direction:column;   /* ⭐ stack vertically */
		align-items:flex-end;    /* right align text & button */
		gap:2px;
		font-size:14px;
	}

	.logout-btn{
		padding:2px 10px;
		font-size:12px;
		border-radius:6px;
		height:26px;
		border:none;
		background:linear-gradient(90deg,#38E8FF,#2BC0FF);
		color:#001018;
		font-weight:700;
		cursor:pointer;
		transition:transform .15s ease, opacity .2s ease;
	}

	
	.logout-btn:hover{
		opacity:.9;
	}

	.logout-btn:active{
		transform:scale(.95);
	}

    /* pill-style */
	.pill-selector{
		display:flex;
		flex-wrap:wrap;
		gap:12px;
		margin-top:15px;
		}

		/* hide default radio */
		.pill-selector input[type="radio"]{
		display:none;
		}

		.pill{
		padding:10px 18px;
		border-radius:999px;
		border:1px solid #2b3a4a;
		background:#0f172a;
		color:#cbd5e1;
		font-size:14px;
		cursor:pointer;
		transition:all .25s ease;
		}

		/* hover */
		.pill:hover{
		border-color:#00e5ff;
		color:#00e5ff;
		}

		/* active selected pill */
		.pill-selector input[type="radio"]:checked + .pill{
		background:linear-gradient(135deg,#00e5ff,#0284c7);
		color:#001219;
		font-weight:600;
		border-color:#00e5ff;
		box-shadow:0 0 10px rgba(0,229,255,.4);
		}
    /* pill-style Ends*/ 

  </style>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com">
  </script>
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
</head>

<body>


<div class="page">	
<!-- ===== TOP ROW ===== -->
<div class="header-bar">
<img class="logo" src="https://ai-implementer.netlify.app/images/ai-implementer-logo.png">

<div class="user-area">
<span>Logged in as: <strong id="loggedUser"></strong></span>
<button class="logout-btn" onclick="logout()">Logout</button>
</div>
</div>

<!-- Hero Section -->
  <header class="relative bg-gradient-to-b from-gray-900 via-gray-800 to-gray-900 text-center px-2" id="top">
   <div class="max-w-4xl mx-auto">
    <h1 class="text-5xl md:text-6xl font-extrabold text-white mb-6 leading-tight">
     Smart
     <span class="text-cyan-400">
      Portfolio Review Report Generator
     </span>
    </h1>
    <p class="text-lg md:text-xl text-gray-300 max-w-2xl mx-auto mb-10">
      Understand where your money is invested, how it is performing,
      and what adjustments can improve balance.
    </p>
   </div>
  </header>
 
    <div class="upload-card">

	<h2>Select Report Type:</h2>

	<div class="pill-selector">

	<input type="radio" id="summary" name="reportType" value="summary" >
	<label for="summary" class="pill">Portfolio Summary</label>

	<input type="radio" id="rebalancing" name="reportType" value="rebalancing" checked>
	<label for="rebalancing" class="pill">Portfolio Re-balancing Report</label>

	<input type="radio" id="opportunity" name="reportType" value="opportunity-insight">
	<label for="opportunity" class="pill">Opportunity Insight Report</label>

	</div>

	</div>


  
  <div class="upload-card">
    <h2>Upload Portfolio CSV</h2>\
	<a href="https://myportfolioassessment.netlify.app/images/portfolio_transactions_sample.png"	
     target="_blank"
     style="display:block;">
    Show Sample File
  </a>

    <form id="uploadForm">
      <input type="file" id="fileInput" accept=".csv" required>
      <button
        class="btn-submit"
        id="submitBtn"
        type="submit"
      >
        Upload & Generate Analysis Report
      </button>
    </form>

    <div id="message"></div>
  </div>

  <div id="result"></div>

</div>

<footer class="footer-bar">
  <div class="footer-status">
    <div id="portfolioServiceStatus" class="status-item">
      <span class="dot"></span>
      <span>Portfolio Analysis: Checking…</span>
    </div>

    <div id="mfapiStatus" class="status-item">
      <span class="dot"></span>
      <span>Service: Checking…</span>
    </div>
  </div>

  <div>
    Powered by
    <a href="https://ai-implementer.netlify.app/" target="_blank">
      AI-Implementer
    </a>
  </div>
</footer>

<script>
  const form = document.getElementById("uploadForm");
  const fileInput = document.getElementById("fileInput");
  const submitBtn = document.getElementById("submitBtn");
  const message = document.getElementById("message");
  const result = document.getElementById("result");
  
  //Add TIMER
  let seconds = 0;
  let timer = null;

  // START TIMER
  function startTimer() {
	  seconds = 0;

	  timer = setInterval(() => {
		seconds++;

		const mins = Math.floor(seconds / 60);
		const secs = seconds % 60;

		message.textContent =
		  mins > 0
			? `Generating report… (${mins}m ${secs}s)`
			: `Generating report… (${secs}s)`;
	  }, 1000);
	}

	// STOP TIMER + FINAL MESSAGE
	function stopTimerSuccess() {
	  if (timer) {
		clearInterval(timer);
		timer = null;
	  }

	  message.textContent = "Report generated successfully";
	}

  //

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    if (!fileInput.files.length) return;

    submitBtn.disabled = true;

    // ⏱ TIMER — added
    startTimer();


    try {
	  result.style.display = "none";
	
      const formData = new FormData();	
      formData.append("file", fileInput.files[0]);
	  
	  // report type
	  const reportType =
	  document.querySelector('input[name="reportType"]:checked').value;
      formData.append("reportType", reportType);

      const response = await fetch(
        "https://unsparse-sherman-nonfallaciously.ngrok-free.dev/webhook/0ed95644-7a7f-4429-848e-06a44becdab0",
        { method: "POST", body: formData }
      );

      const html = await response.text();

      result.innerHTML = html;
      result.style.display = "block";
	  stopTimerSuccess();
      //message.textContent = `Report generated successfully (${seconds}s)`;
    } catch (err) {
      message.textContent = "Failed to generate report. Please try again.";
    } finally {
      clearInterval(timer); // ⏱ stop timer
      submitBtn.disabled = false;
    }
  });
  
  const HEALTH_WEBHOOK = "https://unsparse-sherman-nonfallaciously.ngrok-free.dev/health";
  const LOGIN_PAGE="https://myportfolioassessment.netlify.app/login.html";
  
  async function checkPortfolioService(){
  const el = document.getElementById("portfolioServiceStatus");
  const dot = el.querySelector(".dot");
  const text = el.querySelector("span:last-child");
  dot.classList.remove("up","down");

  try{
    const res = await fetch(HEALTH_WEBHOOK,{cache:"no-store"});
    if(!res.ok) throw 0;
    dot.classList.add("up");
    text.textContent="Portfolio Analysis: Available";
  }catch{
    dot.classList.add("down");
    text.textContent="Portfolio Analysis: Unreachable";
  }
}

async function checkMfapi(){
  const el = document.getElementById("mfapiStatus");
  const dot = el.querySelector(".dot");
  const text = el.querySelector("span:last-child");
  dot.classList.remove("up","down");

  const controller=new AbortController();
  const timeout=setTimeout(()=>controller.abort(),5000);

  try{
    const res=await fetch("https://api.mfapi.in/mf/120503",{signal:controller.signal});
    clearTimeout(timeout);
    const data=await res.json();
    if(!data?.meta?.scheme_name) throw 0;
    dot.classList.add("up");
    text.textContent="Service: Available";
  }catch{
    clearTimeout(timeout);
    dot.classList.add("down");
    text.textContent="Service: Unreachable";
  }
}


const user=localStorage.getItem("authUser");


if(!user){window.location.href=LOGIN_PAGE;}
document.getElementById("loggedUser").innerText=user;


function logout(){
    localStorage.removeItem("authUser");
    window.location.href=LOGIN_PAGE;
}

checkPortfolioService();
checkMfapi();
</script>

</body>
</html>
