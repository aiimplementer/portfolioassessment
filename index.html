<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Portfolio — Wealth Assessment</title>

<style>

/* ===== EXISTING ROOT ===== */
:root {
--bg-dark-1:#050B18;
--bg-dark-2:#08142E;
--bg-card:rgba(255,255,255,0.06);
--border-glass:rgba(255,255,255,0.14);
--text-main:#E6EDFF;
--text-muted:#9AA4C7;
--accent:#38E8FF;
--accent-soft:rgba(56,232,255,0.18);
--radius-lg:18px;
--radius-md:12px;
--shadow-soft:0 20px 50px rgba(0,0,0,.45);
}

*{box-sizing:border-box;}

body{
margin:0;
font-family:Inter,system-ui,-apple-system,Segoe UI,sans-serif;
background:
radial-gradient(1200px 500px at 50% -200px,#0B2B5E 0%,transparent 60%),
linear-gradient(180deg,var(--bg-dark-2),var(--bg-dark-1));
color:var(--text-main);
min-height:100vh;
}

.page{
max-width:1200px;
margin:0 auto;
padding:24px 20px 96px;
}

/* ===== NEW TOP USER BAR ===== */
.top-auth-bar{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:20px;
}

.user-info{
font-size:14px;
color:var(--text-muted);
}

.logout-btn{
padding:8px 14px;
border-radius:10px;
border:none;
background:var(--accent-soft);
color:var(--accent);
font-weight:600;
cursor:pointer;
}

/* ===== EXISTING STYLES CONTINUE ===== */

.upload-card{
padding:22px;
background:var(--bg-card);
backdrop-filter:blur(14px);
border-radius:var(--radius-lg);
border:1px solid var(--border-glass);
box-shadow:var(--shadow-soft);
}

.upload-card h2{
margin:0 0 20px;
font-size:22px;
font-weight:700;
color:var(--accent);
}

input[type="file"]{
width:100%;
padding:12px;
border-radius:var(--radius-md);
border:1px dashed var(--border-glass);
background:rgba(255,255,255,0.05);
color:var(--text-main);
}

input[type="file"]::file-selector-button{
margin-right:12px;
padding:8px 14px;
border-radius:10px;
border:none;
background:var(--accent-soft);
color:var(--accent);
font-weight:600;
cursor:pointer;
}

.btn-submit{
margin-top:22px;
width:100%;
padding:14px;
background:linear-gradient(90deg,#38E8FF,#2BC0FF);
color:#001018;
border:none;
border-radius:var(--radius-md);
font-size:16px;
font-weight:700;
cursor:pointer;
}

.btn-submit:disabled{
opacity:.55;
cursor:not-allowed;
}

#message{
margin-top:14px;
text-align:center;
font-size:14px;
color:var(--text-muted);
}

#result{
display:none;
margin:56px auto 0;
padding:32px;
background:#FFFFFF;
color:#0F172A;
border-radius:var(--radius-lg);
border:1px solid #CBD5E1;
}

.status{margin-top:16px;text-align:center;font-size:14px;min-height:22px;}
.success{color:#22c55e}
.error{color:#ef4444}

.footer-bar{
display:flex;
align-items:center;
justify-content:space-between;
gap:20px;
padding:14px 20px;
font-size:13px;
color:var(--text-muted);
}

.status-item{display:flex;align-items:center;gap:6px;}
.dot{width:8px;height:8px;border-radius:50%;background:#6b7280;}
.dot.up{background:#22c55e}
.dot.down{background:#ef4444}

footer a{color:var(--accent);text-decoration:none;}

</style>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>

</head>

<body>

<div class="page">

<!-- ===== NEW LOGIN BAR ===== -->
<div class="top-auth-bar">
<div class="user-info">
Logged in as: <strong id="loggedUser"></strong>
</div>
<button class="logout-btn" onclick="logout()">Logout</button>
</div>

<header class="relative bg-gradient-to-b from-gray-900 via-gray-800 to-gray-900 text-center px-2">
<div class="max-w-4xl mx-auto">
<h1 class="text-5xl md:text-6xl font-extrabold text-white mb-6 leading-tight">
Smart <span class="text-cyan-400">Portfolio Review Report Generator</span>
</h1>
<p class="text-lg md:text-xl text-gray-300 max-w-2xl mx-auto mb-10">
Understand where your money is invested, how it is performing,
and what adjustments can improve balance.
</p>
</div>
</header>

<div class="upload-card">
<h2>Upload Portfolio CSV</h2>

<form id="uploadForm">
<input type="file" id="fileInput" accept=".csv" required>
<button class="btn-submit" id="submitBtn" type="submit">
Upload & Generate Analysis Report
</button>
</form>

<div id="message"></div>
</div>

<div id="result"></div>

</div>

<footer class="footer-bar">
  <div class="footer-status">
    <div id="portfolioServiceStatus" class="status-item">
      <span class="dot"></span>
      <span>Portfolio Analysis: Checking…</span>
    </div>

    <div id="mfapiStatus" class="status-item">
      <span class="dot"></span>
      <span>Service: Checking…</span>
    </div>
  </div>

  <div>
    Powered by
    <a href="https://ai-implementer.netlify.app/" target="_blank">
      AI-Implementer
    </a>
  </div>
</footer>

<script>

/* ===== LOGIN SESSION CHECK ===== */
const LOGIN_PAGE="https://myportfolioassessment.netlify.app/login.html";

const user=localStorage.getItem("authUser");

if(!user){
window.location.href=LOGIN_PAGE;
}

document.getElementById("loggedUser").innerText=user;

/* ===== LOGOUT ===== */
function logout(){
localStorage.removeItem("authUser");
window.location.href=LOGIN_PAGE;
}

/* ===== EXISTING REPORT SCRIPT ===== */

const form=document.getElementById("uploadForm");
const fileInput=document.getElementById("fileInput");
const submitBtn=document.getElementById("submitBtn");
const message=document.getElementById("message");
const result=document.getElementById("result");

let seconds=0;
let timer=null;

function startTimer(){
seconds=0;
timer=setInterval(()=>{
seconds++;
const mins=Math.floor(seconds/60);
const secs=seconds%60;
message.textContent=
mins>0?`Generating report… (${mins}m ${secs}s)`
:`Generating report… (${secs}s)`;
},1000);
}

function stopTimerSuccess(){
if(timer){clearInterval(timer);timer=null;}
message.textContent="Report generated successfully";
}

form.addEventListener("submit",async(e)=>{
e.preventDefault();
if(!fileInput.files.length)return;
submitBtn.disabled=true;
startTimer();

try{
result.style.display="none";

const formData=new FormData();
formData.append("file",fileInput.files[0]);

const response=await fetch(
"https://unsparse-sherman-nonfallaciously.ngrok-free.dev/webhook/0ed95644-7a7f-4429-848e-06a44becdab0",
{method:"POST",body:formData}
);

const html=await response.text();

result.innerHTML=html;
result.style.display="block";
stopTimerSuccess();

}catch(err){
message.textContent="Failed to generate report. Please try again.";
}finally{
clearInterval(timer);
submitBtn.disabled=false;
}
});

/* ===== HEALTH CHECKS ===== */

const HEALTH_WEBHOOK="https://unsparse-sherman-nonfallaciously.ngrok-free.dev/health";

async function checkPortfolioService(){
const el=document.getElementById("portfolioServiceStatus");
const dot=el.querySelector(".dot");
const text=el.querySelector("span:last-child");
dot.classList.remove("up","down");
try{
const res=await fetch(HEALTH_WEBHOOK,{cache:"no-store"});
if(!res.ok)throw 0;
dot.classList.add("up");
text.textContent="Portfolio Analysis: Available";
}catch{
dot.classList.add("down");
text.textContent="Portfolio Analysis: Unreachable";
}
}

async function checkMfapi(){
const el=document.getElementById("mfapiStatus");
const dot=el.querySelector(".dot");
const text=el.querySelector("span:last-child");
dot.classList.remove("up","down");

const controller=new AbortController();
const timeout=setTimeout(()=>controller.abort(),5000);

try{
const res=await fetch("https://api.mfapi.in/mf/120503",{signal:controller.signal});
clearTimeout(timeout);
const data=await res.json();
if(!data?.meta?.scheme_name)throw 0;
dot.classList.add("up");
text.textContent="Service: Available";
}catch{
clearTimeout(timeout);
dot.classList.add("down");
text.textContent="Service: Unreachable";
}
}

checkPortfolioService();
checkMfapi();

</script>

</body>
</html>
