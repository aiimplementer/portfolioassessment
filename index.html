<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <title>Portfolio ‚Äî Wealth Assessment</title>
      <style>
         :root{
         --bg:#0b0f1a;
         --panel:#111827;
         --panel-soft:#0f172a;
         --border:rgba(255,255,255,.08);
         --text:#f8fafc;
         --muted:#94a3b8;
         --accent:#22d3ee;
         --accent-2:#3b82f6;
         --success:#22c55e;
         --error:#ef4444;
         --radius:14px;
         }
         *{box-sizing:border-box}
         body{
         margin:0;
         font-family:Inter,system-ui,-apple-system,sans-serif;
         background:
         radial-gradient(600px 300px at 80% -10%,rgba(34,211,238,.15),transparent 60%),
         linear-gradient(180deg,#0b1220,#070b14);
         color:var(--text);
         min-height:100vh;
         }
         .page{
         max-width:90%;
         margin:auto;
         padding:18px 18px 4px;
         }
         /* HEADER BAR */
         .header-bar{
         display:flex;
         align-items:center;
         padding:10px 0;
         }
         .logo{
         height:34px;
         }
         .user-area{
         margin-left:auto;
         display:flex;
         flex-direction:column;
         align-items:flex-end;
         gap:2px;
         font-size:13px;
         color:var(--muted);
         }
         .logout-btn{
         padding:3px 12px;
         font-size:12px;
         border-radius:999px;
         border:1px solid var(--border);
         background:linear-gradient(135deg,var(--accent),var(--accent-2));
         color:#001018;
         font-weight:600;
         cursor:pointer;
         transition:.2s ease;
         }
         .logout-btn:hover{opacity:.85}
         /* HERO ‚Äî SMALLER */
         header{
         padding:5px 2px 2px;
         border-radius:14px;
         background:var(--panel-soft);
         border:1px solid var(--border);
         margin-bottom:10px;
         }
         header h1{
         font-size:26px;
         line-height:1.15;
         margin-bottom:12px;
         background:linear-gradient(90deg,#22d3ee,#60a5fa);
         -webkit-background-clip:text;
         -webkit-text-fill-color:transparent;
         }
         header p{
         font-size:13px;
         margin-top:6px;
         margin-bottom:0;
         color:var(--muted);
         }
         /* CARDS */
         .upload-card{
		 display: flex;
		 flex-direction: column;   /* üî• important */
		 align-items: flex-start;  /* left align content */
         background:var(--panel);
         border:1px solid var(--border);
         border-radius:var(--radius);
         padding:18px;
         margin-bottom:16px;
         transition:.2s ease;
		 align-items: center;
		 gap: 20px;
		 flex-wrap: nowrap;   /* prevents wrapping */
		  width:100%;
         }
         .upload-card:hover{
         border-color:rgba(255,255,255,.18);
         }
         .upload-card h2{
		  margin: 0;
         font-size:18	px;
         font-weight:600;         
         color:var(--accent);
		 line-height: 1;        /* removes extra vertical height */
	     display:flex;
		 align-items: center;   /* force perfect vertical centering */
		 gap:20px;
         }
		 
		 #uploadForm{
		  display:flex;
		  flex-direction:column;   /* stack items */
		  gap:16px;
		  flex:1;
		}

		#uploadForm input[type="file"]{
		  flex:0 0 auto;     /* ‚ùå stop full stretch */
		 width:100%;        /* take full width */
		  margin:0;
		  flex:1;          /* makes file input expand */
		}
		 
         /* FILE INPUT */
         input[type="file"]{
         width:100%;
         padding:12px;
         font-size:13px;
         border-radius:10px;
         border:1px dashed rgba(255,255,255,.15);
         background:#0b1220;
         color:var(--text);
         transition:.2s ease;
         }
         input[type="file"]:hover{
         border-color:var(--accent);
         }
         input[type="file"]::file-selector-button{
         margin-right:10px;
         padding:6px 14px;
         border-radius:999px;
         border:none;
         background:linear-gradient(135deg,var(--accent),var(--accent-2));
         color:#001018;
         font-weight:600;
         font-size:12px;
         cursor:pointer;
		 margin:0;
         }
         /* BUTTON */
         .btn-submit{
         margin-top:14px;
         flex:0 0 auto;
		 width:auto;        /* remove 100% width */
         padding:12px;
         font-size:14px;
         font-weight:700;
         border-radius:999px;
         border:none;
         background:linear-gradient(135deg,var(--accent),var(--accent-2));
         color:#001018;
         cursor:pointer;
         transition:.2s ease;
		 margin:0;
         white-space:nowrap;
         }
         .btn-submit:hover{
         transform:translateY(-1px);
         }
         .btn-submit:disabled{
         opacity:.5;
         cursor:not-allowed;
         }
         /* MESSAGE */
         #message{
         font-size:14px;
         color:var(--muted);
		 min-height: 20px; 
         }
         /* RESULT */
         #result{
         display:none;	
         margin-top:20px;
         padding:24px;
         border-radius:14px;
         background:#ffffff;
         color:#0f172a;
         }
         #result table{
         width:100%;
         border-collapse:collapse;
         font-size:13px;
         }
         #result thead th{
         background:#0f172a;
         color:#fff;
         padding:10px;
         }
         #result td{
         padding:8px 10px;
         border-bottom:1px solid #e2e8f0;
         }
         #result tbody tr:nth-child(even){
         background:#f1f5f9;
         }
         .gain{color:var(--success);font-weight:600}
         .loss{color:var(--error);font-weight:600}
         /* PILLS */
         .pill-selector{
         display:flex;
         flex-wrap:wrap;
         gap:8px;
         margin-top:8px;
		 align-items: center;  
         }
         .pill-selector input[type="radio"]{
         display:none;
         }
         .pill{
         padding:8px 18px;
         font-size:12px;
         border-radius:999px;
         border:1px solid var(--border);
         background:#0b1220;
         color:var(--muted);
         cursor:pointer;
         transition:.2s ease;
		 display: flex;
		 align-items: center;  
         }
         .pill:hover{
         border-color:var(--accent);
         color:var(--accent);
         }
         .pill-selector input[type="radio"]:checked + .pill{
         background:linear-gradient(135deg,var(--accent),var(--accent-2));
         color:#001018;
         font-weight:600;
		 align-items: center; 
         }
         /* FOOTER */
         .footer-bar{
         display:flex;
         justify-content:space-between;
         align-items:center;
         padding:12px 20px;
         font-size:12px;
         border-top:1px solid var(--border);
         color:var(--muted);
         margin-top:2px;
         width=90%;
         }
         .footer-status{
         display:flex;
         gap:18px;
         }
         .status-item{
         display:flex;
         align-items:center;
         gap:6px;
         }
         .dot{
         width:7px;
         height:7px;
         border-radius:50%;
         background:#6b7280;
         }
         .dot.up{background:var(--success)}
         .dot.down{background:var(--error)}
         footer a{
         color:var(--accent);
         text-decoration:none;
         }
         /* PRINT */
         @media print{
         header,.upload-card,#message{display:none!important}
         body{background:#fff!important}
         #result{display:block!important;padding:0}
         }
         /* Top Highlight Strip */
         header#top{
         background: linear-gradient(
         90deg,
         rgba(34,211,238,.08),
         rgba(59,130,246,.08)
         ),
         var(--panel-soft);
         border: 1px solid rgba(255,255,255,.08);
         border-radius: 12px;
         backdrop-filter: blur(6px);
         box-shadow:
         0 0 0 1px rgba(255,255,255,.04),
         0 8px 20px rgba(0,0,0,.35);
         margin-bottom: 2px;
         }
         /* Subtle glow line on top */
         header#top::before{
         content:"";
         display:block;
         height:2px;
         width:100%;
         background: linear-gradient(90deg,#22d3ee,#3b82f6);
         border-radius: 12px 12px 0 0;
         }
      </style>
      <!-- Tailwind CSS -->
      <script src="https://cdn.tailwindcss.com"></script>
      <!-- Google Font -->
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
   </head>
   <body>
      <div class="page">
         <!-- ===== TOP ROW ===== -->
         <div class="header-bar">
            <img class="logo" src="https://ai-implementer.netlify.app/images/ai-implementer-logo.png">
            <div class="user-area">Smart Portfolio Review Report Generator</div>
            <div class="user-area">
               <span>Logged in as: <strong id="loggedUser"></strong></span>
               <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
         </div>
         <!-- Hero Section -->
         <header class="relative bg-gradient-to-b from-gray-900 via-gray-800 to-gray-900 text-center px-2" id="top">
            <div class="max-w-4xl mx-auto">
               <p class="text-lg md:text-xl text-gray-300 max-w-2xl mx-auto mb-5">
                  Understand where your money is invested, how it is performing,
                  and what adjustments can improve balance.
               </p>
            </div>
         </header>
         <div class="upload-card">
            <h2>Select Report Type:</h2>
            <div class="pill-selector">
               <input type="radio" id="summary" name="reportType" value="summary" checked>
               <label for="summary" class="pill">Portfolio Summary</label>
               <input type="radio" id="rebalancing" name="reportType" value="rebalancing">
               <label for="rebalancing" class="pill">Portfolio Re-balancing Report</label>
               <input type="radio" id="monthly" name="reportType" value="monthly">
               <label for="monthly" class="pill">Monthly Insight Report</label>
            </div>
         </div>
         <div class="upload-card">
            <h2>Upload Portfolio PDF</h2>
            <form id="uploadForm">
               <input type="file" id="fileInput" accept=".pdf" required>
               <button
                  class="btn-submit"
                  id="submitBtn"
                  type="submit"
                  >
               Upload & Generate Analysis Report
               </button>
			   
			   <div id="message"></div>
            </form>
			
            
			
         </div>
         <div id="result"></div>
         <footer class="footer-bar">
            <div class="footer-status">
               <div id="portfolioServiceStatus" class="status-item">
                  <span class="dot"></span>
                  <span>Portfolio Analysis: Checking‚Ä¶</span>
               </div>
               <div id="mfapiStatus" class="status-item">
                  <span class="dot"></span>
                  <span>Service: Checking‚Ä¶</span>
               </div>
            </div>
            <div>
               Powered by
               <a href="https://ai-implementer.netlify.app/" target="_blank">
               AI-Implementer
               </a>
            </div>
         </footer>
      </div>
      <script>
         const form = document.getElementById("uploadForm");
         const fileInput = document.getElementById("fileInput");
         const submitBtn = document.getElementById("submitBtn");
         const message = document.getElementById("message");
         const result = document.getElementById("result");
         
         
         //Add TIMER
         let seconds = 0;
         let timer = null;
         
         // START TIMER
         function startTimer() {
          seconds = 0;
         
          timer = setInterval(() => {
         seconds++;
         
         const mins = Math.floor(seconds / 60);
         const secs = seconds % 60;
         
         message.textContent =
           mins > 0
         	? `Generating report‚Ä¶ (${mins}m ${secs}s)`
         	: `Generating report‚Ä¶ (${secs}s)`;
          }, 1000);
         }
         
         // STOP TIMER + FINAL MESSAGE
         function stopTimerSuccess() {
          if (timer) {
         clearInterval(timer);
         timer = null;
          }
         
          message.textContent = "Report generated successfully";
         }
         
         //
         
         form.addEventListener("submit", async (e) => {
           e.preventDefault();
         
           if (!fileInput.files.length) return;
         
           submitBtn.disabled = true;
         
           // ‚è± TIMER ‚Äî added
           startTimer();
         
         
           try {
          result.style.display = "none";
         
             const formData = new FormData();	
             formData.append("file", fileInput.files[0]);
          
          // report type
          const reportType =
          document.querySelector('input[name="reportType"]:checked').value;
             formData.append("reportType", reportType);
         
             const response = await fetch(
               "https://unsparse-sherman-nonfallaciously.ngrok-free.dev/webhook/96172d87-8674-48d1-acc4-e43b2ddbe9a4",
         
         
               { method: "POST", body: formData }
             );
         
             const html = await response.text();
         
             result.innerHTML = html;
             result.style.display = "block";
          stopTimerSuccess();
             //message.textContent = `Report generated successfully (${seconds}s)`;
           } catch (err) {
             message.textContent = "Failed to generate report. Please try again.";
           } finally {
             clearInterval(timer); // ‚è± stop timer
             submitBtn.disabled = false;
           }
         });
         
         const HEALTH_WEBHOOK = "https://unsparse-sherman-nonfallaciously.ngrok-free.dev/health";
         const LOGIN_PAGE="https://myportfolioassessment.netlify.app/login.html";
         const SYNC_NAV_WEBHOOK =
         "https://unsparse-sherman-nonfallaciously.ngrok-free.dev/webhook-test/38bb8332-dd92-4994-97ad-b2bf8a4e7758";
         
         async function checkPortfolioService(){
         const el = document.getElementById("portfolioServiceStatus");
         const dot = el.querySelector(".dot");
         const text = el.querySelector("span:last-child");
         dot.classList.remove("up","down");
         
         try{
           const res = await fetch(HEALTH_WEBHOOK,{cache:"no-store"});
           if(!res.ok) throw 0;
           dot.classList.add("up");
           text.textContent="Portfolio Analysis: Available";
         }catch{
           dot.classList.add("down");
           text.textContent="Portfolio Analysis: Unreachable";
         }
         }
         
         async function checkMfapi(){
         const el = document.getElementById("mfapiStatus");
         const dot = el.querySelector(".dot");
         const text = el.querySelector("span:last-child");
         dot.classList.remove("up","down");
         
         const controller=new AbortController();
         const timeout=setTimeout(()=>controller.abort(),5000);
         
         try{
           const res=await fetch("https://api.mfapi.in/mf/120503",{signal:controller.signal});
           clearTimeout(timeout);
           const data=await res.json();
           if(!data?.meta?.scheme_name) throw 0;
           dot.classList.add("up");
           text.textContent="Service: Available";
         }catch{
           clearTimeout(timeout);
           dot.classList.add("down");
           text.textContent="Service: Unreachable";
         }
         }
         
         
         const user=localStorage.getItem("authUser");
         
         
         if(!user){window.location.href=LOGIN_PAGE;}
         document.getElementById("loggedUser").innerText=user;
         
         
         function logout(){
           localStorage.removeItem("authUser");
           window.location.href=LOGIN_PAGE;
         }
         
         checkPortfolioService();
         checkMfapi();
      </script>
   </body>
</html>